passport._define("topBar.js",function(){var passport=passport||window.passport||{},baidu=passport.tangramInst||baidu||window.baidu;(function(ns){ns.apiDomain={staticDomain:(window.location?((window.location.protocol.toLowerCase()=="http:")?"http://passport.bdimg.com":"https://passport.baidu.com"):((document.location.protocol.toLowerCase()=="http:")?"http://passport.bdimg.com":"https://passport.baidu.com"))}})(passport);if(passport.library){var baidu=passport.library}var magic=null;if(typeof magic!="function"){var magic=function(){}}var createClass=function(constructor,options){options=options||{};var superClass=options.superClass||baidu.lang.Class;var fn=function(){var me=this;options.decontrolled&&(me.__decontrolled=true);superClass.apply(me,arguments);for(i in fn.options){me[i]=fn.options[i]}constructor.apply(me,arguments);for(var i=0,reg=fn["\x06r"];reg&&i<reg.length;i++){reg[i].apply(me,arguments)}};fn.options=options.options||{};var C=function(){},cp=constructor.prototype;C.prototype=superClass.prototype;var fp=fn.prototype=new C();for(var i in cp){fp[i]=cp[i]}var type=options.className||options.type;typeof type=="string"&&(fp.__type=type);fp.constructor=cp.constructor;fn.extend=function(json){for(var i in json){fn.prototype[i]=json[i]}return fn};return fn};passport.topGUid=passport.topGUid||1;magic.Base=function(){this.guid="PASSP__"+passport.topGUid++;this._ids={};this._eid=this.guid+"__"};magic.Base.fn=magic.Base.prototype;magic.Base.proxy=function(func){var me=this;return(function(){func.apply(me,arguments)})};magic.Base.extend=function(obj){var extend=obj.extend;for(var i in obj){if(obj.hasOwnProperty(i)){magic.Base.fn[i]=obj[i]}}extend&&extend(magic.Base)};magic.Base.include=function(obj){var included=obj.included;for(var i in obj){if(obj.hasOwnProperty(i)){magic.Base[i]=obj[i]}}included&&included(magic.Base)};magic.Base.fn.proxy=magic.Base.proxy;magic.Base.extend({getElement:function(id){return document.getElementById(this.$getId(id))},getElements:function(){var result={};var _ids=this._ids;for(var key in _ids){result[key]=this.getElement(key)}return result},$getId:function(key){key=(Object.prototype.toString.call(key)=="[object String]")?key:"";return this._ids[key]||(this._ids[key]=this._eid+key)},$mappingDom:function(key,dom){if(Object.prototype.toString.call(dom)=="[object String]"){this._ids[key]=dom}else{if(dom&&dom.nodeType){dom.id?this._ids[key]=dom.id:dom.id=this.$getId(key)}}return this},$hide:function(ele){if((typeof ele).toLowerCase()=="string"||ele===""){ele=this.getElement(ele)}if(ele&&ele.style){ele.style.display="none"}return this},$show:function(ele){if((typeof ele).toLowerCase()=="string"||ele===""){ele=this.getElement(ele)}if(ele&&ele.style){ele.style.display="block"}return this}});magic.passport=createClass(function(){},{type:"magic.passport",superClass:magic.Base}).extend({on:function(ev,callback){var calls=this._callbacks||(this._callbacks={});if(!this._callbacks[ev]){this._callbacks[ev]=[]}this._callbacks[ev].push(callback);return this},fire:function(ev,e){var e=e||{},list,calls,i,l;if(!(calls=this._callbacks)){return this}if(!(list=this._callbacks[ev])){return this}e.returnValue=true;for(i=0,l=list.length;i<l;i++){list[i](e)}return e.returnValue},fireEvent:function(event,param){var continueDefault=this.fire(event,param);return continueDefault}});var passport=passport||window.passport||{};passport.data=passport.data||{};(function(ns){var _blankFunc=function(){};function Promise(initCallback){this._requests=[];this._value=null;this._exception=null;this._isComplete=false;var promise=this;initCallback(function(value){promise._fulfillPromise(value)},function(value){promise._breakPromise(value)})}Promise.prototype={get_isComplete:function(){return this._isComplete},get_value:function(){if(!this._isComplete){return undefined}if(this._exception){throw this._exception}return this._value},call:function(name,params){var args=[];for(var i=0,l=arguments.length-1;i<l;i++){args[i]=arguments[i+1]}return this.when(function(v){return v[name].apply(v,args)})},getValue:function(name){return this.when(function(v){return v[name]})},setValue:function(name,value){this.whenOnly(function(v){v[name]=value})},when:function(fulfillPromise,breakPromise,context){return Promise.when(this,fulfillPromise,breakPromise,context)},whenOnly:function(fulfillPromise,breakPromise,context){Promise.whenOnly(this,fulfillPromise,breakPromise,context)},success:function(fulfillPromise,context){return this.when(fulfillPromise,_blankFunc,context)},fail:function(breakPromise,context){return this.when(_blankFunc,breakPromise,context)},_enqueueOne:function(op){if(this._isComplete){this._notify(op)}else{this._requests.push(op)}},_notify:function(op){if(this._exception){if(op.breakPromise){op.breakPromise(this._exception)}}else{if(op.fulfillPromise){op.fulfillPromise(this._value)}}},_notifyAll:function(){for(var i=0,l=this._requests.length;i<l;i++){this._notify(this._requests[i])}},_fulfillPromise:function(value){this._value=value;this._exception=null;this._isComplete=true;this._notifyAll()},_breakPromise:function(exception){this._value=null;this._exception=exception||new Error("An error occured");this._isComplete=true;this._notifyAll()}};Promise.when=function(promise,fulfillPromise,breakPromise,context){return new Promise(function(fp,bp){Promise.make(promise)._enqueueOne({fulfillPromise:function(value){if(fulfillPromise){fp(fulfillPromise.call(context,value))}else{fp(value)}},breakPromise:function(exception){if(breakPromise){try{fp(breakPromise.call(context,exception))}catch(e){bp(e)}}else{bp(exception)}}})})};Promise.whenOnly=function(promise,fulfillPromise,breakPromise,context){Promise.make(promise)._enqueueOne({fulfillPromise:function(value){if(fulfillPromise){fulfillPromise.call(context,value)}},breakPromise:function(exception){if(breakPromise){breakPromise.call(context,exception)}}})};Promise.make=function(value){if(value instanceof Promise){return value}return Promise.immediate(value)};Promise.immediate=function(value){return new Promise(function(fulfillPromise,breakPromise){fulfillPromise(value)})};var Request={};(function(Request){var _postContainer="__bdpp_pstc__"+new Date().getTime(),_postForm=_postContainer+"_form",_postTarget=_postContainer+"_ifr";var getUniqueId=function(prefix){return prefix+Math.floor(Math.random()*2147483648).toString(36)};var _buildQuery=function(query){if(typeof(query)=="object"){var builder=[];for(var p in query){var value=query[p];if(value!==undefined&&value!==null){if(builder.length){builder.push("&")}var valueString=encodeURIComponent(typeof(value)=="boolean"?(value?"1":"0"):value.toString());builder.push(encodeURIComponent(p),"=",valueString)}}return builder.join("")}if(typeof(query)=="string"){return query}return null};var _appendQuery=function(url,query){query=_buildQuery(query);if(typeof(query)=="string"){var hasQuery=(/\?/g).test(url);url+=(hasQuery?"&":"?")+_buildQuery(query)}return url};var _createScriptTag=function(scr,url,charset){scr.setAttribute("type","text/javascript");charset&&scr.setAttribute("charset",charset);scr.setAttribute("src",url);document.getElementsByTagName("head")[0].appendChild(scr)};var _removeScriptTag=function(scr){if(scr.clearAttributes){scr.clearAttributes()}else{for(var attr in scr){if(scr.hasOwnProperty(attr)){delete scr[attr]}}}if(scr&&scr.parentNode){scr.parentNode.removeChild(scr)}scr=null};var _callByServer=function(url,callback,opt_options){var scr=document.createElement("SCRIPT"),prefix="bd__cbs__",callbackName,callbackImpl,options=opt_options||{},charset=options.charset,queryField=options.queryField||"callback",timeOut=options.timeOut||0,timer,reg=new RegExp("(\\?|&)"+queryField+"=([^&]*)"),matches;callbackName=getUniqueId(prefix);window[callbackName]=getCallBack(0);if(timeOut){timer=setTimeout(getCallBack(1),timeOut)}url=url.replace(reg,"\x241"+queryField+"="+callbackName);if(url.search(reg)<0){url+=(url.indexOf("?")<0?"?":"&")+queryField+"="+callbackName}_createScriptTag(scr,url,charset);function getCallBack(onTimeOut){return function(){try{if(onTimeOut){options.onfailure&&options.onfailure()}else{callback.apply(window,arguments);clearTimeout(timer)}window[callbackName]=null;delete window[callbackName]}catch(exception){}finally{_removeScriptTag(scr)}}}};Request.jsonp=function(url,query,options){options=options||{};var originUrl=url;return new Promise(function(fulfillPromise,breakProimise){url=_appendQuery(url,query);_callByServer(url,function(jsonResult){fulfillPromise&&fulfillPromise(jsonResult)},{charset:options.charset,queryField:options.queryField,timeOut:options.timeOut,onfailure:function(){breakProimise&&breakProimise()}})})}})(Request);var _domain="https://passport.baidu.com";ns.jsonp=function(url,params){if(url.indexOf("http")!=0){url=_domain+url}params=params||{};params.tt=new Date().getTime();return Request.jsonp(url,params,{charset:"utf-8"})};ns.request=Request})(passport.data);magic.passport.topBar=createClass(function(options){var me=this;me._domain=passport.apiDomain;me.config={product:"pp",charset:"",styleId:"",u:"",defaultStyle:0,loginType:options.loginType||0,lang:"zh-CN"};for(var i in options){me.config[i]=options[i]}this.module="topBar";me._ajaxDomain=me.config.product=="pp"?"https://topmsg.baidu.com":"";me.msgData={id:"",init:false,data:[],currentMsgType:"personal",personalCurrentPage:0,personalNum:3,status:0};me.constant={ITEMHOVERCLASS:"pass-topBar-item-hover",DEFAULTSTYLE:"/passApi/css/topBar_default_85d01575.css"};me.msgTimer=30},{type:"magic.passport.topBar",superClass:magic.passport}).extend({_getIrregularField:function(field){var me=this,template={user:'<dl class="pass-topBar-select pass-user"><dt class="pass-user-avatar"><img src="{#icon#}" width="60" height="60"/></dt><dd class="pass-user-info"><div><span class="pass-user-username" title="{#name#}">{#briefName#}</span> <a href="https://passport.baidu.com/?logout&u='+encodeURIComponent(me.config.u||"")+'">[退出]</a></div><div class="pass-user-links"><a class="pass-user-links-first" href="{#prinessHref#}" target="_blank">我的百度</a><a href="http://passport.baidu.com/center?_t='+(new Date().getTime())+'" target="_blank">帐号设置</a></div></dd></dl>',msg:'<div class="pass-topBar-msgSelect pass-topBar-msgWrapper" id="'+me.$getId("msgWrapper")+'"><div class="pass-msg-title clearfix"><ul><li t="personal" id="'+me.$getId("personalMsgTab")+'" class="pass-msgType-current">我的消息<span class="pass-msg-num"><em></em></span></li><li t="notice" id="'+me.$getId("noticeMsgTab")+'">系统通知<span class="pass-msg-num"><em></em></span></li></ul></div><div id="'+me.$getId("msgContent")+'" class="pass-msg-content"><div class="pass-msgList-wrapper pass-msgType-personal" id="'+me.$getId("personalMsgList")+'"></div><div class="pass-msgList-wrapper pass-msgType-notice" id="'+me.$getId("noticeMsgList")+'"></div></div><div id="'+me.$getId("msgOpt")+'" class="pass-msgList-opt"><a class="pass-msg-read">全部已读</a><a class="pass-msg-all" href="http://passport.baidu.com/v2/?messagehistory" target="_blank">全部消息</a><a class="pass-msg-setting" href="http://passport.baidu.com/v2/?messageconfig" target="_blank"></a></div></div>',msgLoading:'<p class="pass-msg-tip">请稍等...</p>',ul:'<ul class="clearfix"></ul>',personalMsgItem:'<li class="pass-msgList-item" id="'+me.$getId("msgList{#tpl#}")+'"><div class="pass-msgList-p15"><div class="pass-msgList-product">{#product#}</div><div class="pass-msgList-content">{#content#}</div>{#productMoreMsg#}</div></li>',noticeMsgItem:'<li class="pass-msgList-item"><div class="pass-msgList-p15"><div class="pass-msgList-from">来自{#product#}</div><div class="pass-msgList-content">{#content#}</div>{#concreteMsg#}</div></li>',productMoreMsg:'<div class="pass-productMsg-more"><a href="{#moreUrl#}" target="_blank">更多></a></div>',concreteMsg:'<div class="pass-productMsg-more"><a href="{#concreteUrl#}" target="_blank">查看完整内容></a></div>',msgNewTemp:'<span class="pass-msg-new"></span>',msgItemTemp:'<p class="pass-msgList-contentItem" s="{#status#}" t="{#msgType#}" mid="{#id#}" tpl="{#tpl#}">{#html#}{#msgStatus#}<a class="pass-msgList-remove"></a></p>',msgNone:'<p class="pass-msg-tip">您暂时没有未读消息</p>',msgListMore:'<div class="pass-msgList-moreWrapper"><span id="'+me.$getId("msgListMore")+'" class="pass-msgList-moreLink">查看更多</span></div>'};return template[field]},checkServerTime:function(time){var me=this;me.serverTimeInit=time||me.serverTimeInit;setInterval(function(){me.serverTimeInit=parseInt(me.serverTimeInit)+1000},1000)},_loadScript:function(u,callback){var d=document,s=d.createElement("SCRIPT");s.type="text/javascript";s.charset="UTF-8";s.src=u;d.getElementsByTagName("head")[0].appendChild(s);if(s.readyState){s.onreadystatechange=function(){if(s.readyState=="loaded"||s.readyState=="complete"){s.onreadystatechange=null;callback&&callback()}}}else{s.onload=function(){callback&&callback()}}},_loadCss:function(u){var me=this,d=document,l=d.createElement("link");l.rel="stylesheet";l.type="text/css";l.href=me._domain.staticDomain+u;l.disabled=false;d.getElementsByTagName("head")[0].appendChild(l)},getData:function(){var me=this;me._loadScript(me._domain.staticDomain+"/topBar/"+me.config.product+"/topconfig.js?_t="+(new Date().getTime()),function(){me.data=passport.topBarData&&passport.topBarData["sid"+me.config.styleId];if(!me.data){for(var i in passport.topBarData){me.data=passport.topBarData[i];break}}passport.topBarData=null;if((me.config.loginType==0)||(me.config.loginType==1&&me.userData)){me.drawPreview(me._getTemplate())}})},getUserData:function(){var me=this;passport.data.jsonp(me._ajaxDomain+"/v2/?ucentertopbarinit").success(function(args){me.userData=args.data;me._updataMsgStatus(me.userData.newMsg);me.checkServerTime(args.data.serverTime||(new Date().getTime()));me.config.loginType=me.userData.loginType;if(me.data){me.drawPreview(me._getTemplate())}})},subStr:function(str,num){var len=str.length;if(str.replace(/[\u4e00-\u9fbf]/g,"**").length<=num){return str}while(str.replace(/[\u4e00-\u9fbf]/g,"**").length>num){str=str.slice(0,len--)}return str+"..."},tplEngine:function(tpl,data){return tpl.replace(/\{#([^#\}]+)?#\}/g,function(s0,s1){return data[s1]?data[s1]:""})},changeHtml:function(str,href){var me=this,reg=/\[msg\|href=(.*?)\|text=(.*?)(?:\|target=(.*?))?\|endmsg\]/g;return str.replace(reg,function($,$1,$2,$3){return'<a href="'+(href?(href+"&u="+encodeURIComponent($1)):$1)+'"'+($3?" target="+$3:"")+">"+$2+"</a>"})},_getTemplate:function(){var me=this,data=me.data[(me.config.loginType==1)?"hlogin":"nlogin"],d,subConfig,m=0,temp=[];temp.push('<div id="'+me.$getId("topBarWrapper")+'" class="pass-top-bar">');temp.push('<ul class="pass-topBar-list">');for(var i in data){d=data[i];if(d.type=="user"){d=baidu.extend(d,me.userData);d.briefName=me.subStr(d.name,12);if(d.username){d.prinessHref="http://www.baidu.com/p/"+d.username+"?from="+me.config.product}else{d.prinessHref=""}}if(d.type=="msg"){me.msgData.id=d.id||"";d.name=""}subConfig=d.subConfig;subConfigLength=(subConfig&&subConfig.length>0)||false;temp.push('<li id="'+me.$getId("level1_"+d.id)+'" data-id="'+d.id+'" class="pass-topBar-item pass-topBar-item-'+d.type+((m++)==0?" pass-topBar-item-first":"")+'" t="'+d.type+'">');if(d.type=="msg"){temp.push('<a data-level="1" class="pass-topBar-level1'+((me.userData&&me.userData.newMsg==1)?" pass-topBar-newMsg":"")+'">')}else{temp.push('<a data-level="1" class="pass-topBar-level1'+(d.icon?" pass-topBar-iconWrappaer":"")+(d.js?" pass-topBar-jsMethod":"")+'"'+(d.href?' href="'+d.href+'"':"")+(d.target?' target="_blank"':"")+">");if(d.icon){temp.push('<img src="'+d.icon+'" height="18"/>')}temp.push('<span class="pass-topBar-name">'+d.name+"</span>");if(subConfigLength||(d.type=="user")){temp.push('<span class="pass-topBar-arr"></span>')}}temp.push("</a>");if(subConfigLength){temp.push('<div class="pass-topBar-custom pass-topBar-select" t="'+d.type+'">');for(var j=0,len=subConfig.length;j<len;j++){var arr=[],subData=subConfig[j];temp.push('<a id="'+me.$getId("level2-"+subData.id)+'" data-id="'+subData.id+'" data-level="2" data-sort="'+j+'" class="pass-topBar-subMenu'+(j+1)+" pass-topBar-level2"+(subData.icon?" pass-topBar-iconWrappaer":"")+(subData.js?" pass-topBar-jsMethod":"")+'"'+(subData.href?' href="'+subData.href+'"':"")+(subData.target?' target="_blank"':"")+">");if(subData.icon){temp.push('<img src="'+subData.icon+'" height="18"/>')}temp.push('<span class="pass-topBar-name">'+subData.name+"</span>");temp.push("</a>")}temp.push("</div>")}if(d.type=="user"&&me.config.userShowType!=1){var userTemp=me._getIrregularField("user");temp.push(me.tplEngine(userTemp,d))}if(d.type=="msg"){var userTemp=me._getIrregularField("msg");temp.push(me.tplEngine(userTemp,d))}temp.push("</li>")}temp.push("</ul>");temp.push("</div>");return temp.join("")},_updataMsgStatus:function(bool){this.msgData.status=bool?1:0},_setMsgStatus:function(bool){var me=this,msgDom=baidu(".pass-topBar-item-msg .pass-topBar-level1",me.getElement("topBarWrapper"));if(bool){if(!baidu(me.getElement("level1_"+me.msgData.id)).hasClass(me.constant.ITEMHOVERCLASS)){msgDom.addClass("pass-topBar-newMsg");me._updataMsgStatus(1)}}else{msgDom.removeClass("pass-topBar-newMsg");me._updataMsgStatus(0)}},_changeMsgStatus:function(time){var me=this,msgDom=baidu(".pass-topBar-item-msg .pass-topBar-level1",me.getElement("topBarWrapper"));function getMsgFn(){passport.data.jsonp(me._ajaxDomain+"/v2/?messagenew&tpl="+me.config.product+"&time="+(new Date().getTime())).success(function(rsp){me._setMsgStatus(rsp.errInfo.no==0?true:false);me.msgTimer=parseInt(rsp.data.timer)||me.msgTimer})}me.getMsgTimer=setInterval(function(){if(me.msgData.status==1){return}var topMsgVal=/(?:^|;)\s*TOPMSG=([^;]*)/g.exec(document.cookie);if(Object.prototype.toString.call(topMsgVal).toLowerCase()=="[object array]"){var arr=topMsgVal[1].split("-");if(parseInt(me.serverTimeInit)-parseInt(arr[0])<me.msgTimer){if(arr[1]===1){me._setMsgStatus(true)}return}else{getMsgFn()}}else{getMsgFn()}},me.msgTimer*1000)},_removeMsg:function(tpl,ids,realdel,delall){var me=this;if(Object.prototype.toString.call(ids).toLowerCase()=="[object array]"){me.removeMsgIds.push.apply(me.removeMsgIds,ids);ids=ids.join(",")}else{me.removeMsgIds.push(ids)}passport.data.jsonp(me._ajaxDomain+"/v2/?messagedel&delall="+(delall||"")+"&realdel="+(realdel||"")+"&msgid="+ids+"&tpl="+tpl+"&time="+(new Date().getTime())).success(function(rsp){})},_getMsgData:function(){var me=this,typeArr=["personal","notice"];for(var i=0,len=typeArr.length;i<len;i++){me.getElement(typeArr[i]+"MsgList").innerHTML=me._getIrregularField("msgLoading")}passport.data.jsonp(me._ajaxDomain+"/v2/?messageget&tpl="+me.config.product+"&time="+(new Date().getTime())).success(function(rsp){if(rsp.errInfo.no==0){me.msgData.data=rsp.data;me.removeMsgIds=[];me.msgData.personalCurrentPage=0}var parentDom=me.getElement("level1_"+me.msgData.id),selectList=baidu(".pass-topBar-msgSelect",parentDom).get(0);me._setSelectPos(parentDom,selectList);for(var i=0,len=typeArr.length;i<len;i++){me.upMsgNewNum(typeArr[i])}me._setPersonalMsg();me._setNoticeMsg();if(me.msgData.currentMsgType=="notice"){setTimeout(function(){me._setNoticeMsgStatus()},500)}})},_inArray:function(arr,str){var me=this;for(var i=0,len=arr.length;i<len;i++){if(arr[i]===str){return i}}return -1},_read:function(){var me=this,parents=me.getElement(me.msgData.currentMsgType+"MsgList"),span=baidu(".pass-msg-new",parents),delall=0,removeArr=[];if(me.msgData.currentMsgType=="personal"&&me.msgData.data.personalMsgList){var personalMsgData=me.msgData.data.personalMsgList.list||{},pd;me.msgData.data.personalMsgList.list=[];for(var i=0,len=span.length;i<len;i++){me._removeNewStatus(span[i])}delall=1}else{if(me.msgData.currentMsgType=="notice"){for(var i=0,len=span.length;i<len;i++){var dom=span[i];removeArr.push(baidu(dom.parentNode).attr("mid"));me._removeNewStatus(dom)}}}me._removeMsg("",removeArr,"",delall)},upMsgNewNum:function(type,num){var me=this,dom=me.getElement(type+"MsgTab"),span=baidu(".pass-msg-num",dom);if(num=="-1"){me.msgData.data[type+"MsgList"].newNum=Math.max(--me.msgData.data[type+"MsgList"].newNum,0);num=me.msgData.data[type+"MsgList"].newNum}else{num=num||me.msgData.data[type+"MsgList"].newNum}span.children("em").html(num);span.get(0).style.display=(num>0?"block":"none");if(me.msgData.data.noticeMsgList.newNum+me.msgData.data.personalMsgList.newNum<=0){me._setMsgStatus(false)}},_setNoticeMsgStatus:function(){var me=this,li=baidu(".pass-msgList-item",me.getElement("noticeMsgList")),noticeMsgListDom=me.getElement("noticeMsgList"),height=noticeMsgListDom.offsetHeight,top=baidu(noticeMsgListDom).scrollTop(),itemHeight=0,resultHeight=0,midArray=[];for(var i=0,len=li.length;i<len;i++){itemHeight=li[i].offsetHeight;resultHeight+=itemHeight;var p=baidu(".pass-msgList-contentItem",li[i]);if(p.attr("s")==1){midArray.push(p.attr("mid"));me._removeNewStatus(p.children()[0],true)}if(resultHeight>height+top){break}}if(midArray.length>0){me._removeMsg("",midArray.join(","))}},_setPersonalMsg:function(){var me=this,personalMsgData=(me.msgData.data.personalMsgList&&me.msgData.data.personalMsgList.list)||{};temp=[];if(personalMsgData.length){var personalDom=me.getElement("personalMsgList"),listDom,i=me.msgData.personalCurrentPage*me.msgData.personalNum,j=Math.min(i+me.msgData.personalNum,personalMsgData.length),o=i,p=j,pd,cd;if(me.msgData.personalCurrentPage==0){personalDom.innerHTML=""}listDom=baidu("ul",personalDom);if(!listDom.length){personalDom.innerHTML=me._getIrregularField("ul");listDom=baidu("ul",personalDom)}for(i;i<j;i++){pd=personalMsgData[i];var cTemp=[];if(!pd.tpl){continue}for(var m=0,n=pd.msg.length;m<n;m++){cd=pd.msg[m];cd.html=me.changeHtml(cd.html,"https://passport.baidu.com/v2/?messagedeal&tpl="+pd.tpl+"&msgid="+cd.id);if(cd.status==1){cd.msgStatus=me._getIrregularField("msgNewTemp")}cd.msgType="personal";cTemp.push(me.tplEngine(me._getIrregularField("msgItemTemp"),cd))}if(pd.moreUrl){pd.productMoreMsg=me.tplEngine(me._getIrregularField("productMoreMsg"),{moreUrl:pd.moreUrl})}pd.content=cTemp.join("");temp.push(me.tplEngine(me._getIrregularField("personalMsgItem"),pd))}listDom.append(baidu(temp.join("")));var moreDom=me.getElement("msgListMore");if(((++me.msgData.personalCurrentPage)*me.msgData.personalNum)>=personalMsgData.length){if(me.getElement("msgListMore")){baidu(moreDom).parent().remove()}}else{if(!me.getElement("msgListMore")){baidu(me.getElement("personalMsgList")).append(baidu(me._getIrregularField("msgListMore")))}}me._setMouseEvent("personal",o,p)}else{temp.push(me._getIrregularField("msgNone"));me.getElement("personalMsgList").innerHTML=temp.join("")}},_setNoticeMsg:function(){var me=this,noticeMsgData=(me.msgData.data.noticeMsgList&&me.msgData.data.noticeMsgList.list)||{};temp=[];if(noticeMsgData.length){var noticeDom=me.getElement("noticeMsgList"),listDom,i=0,j=noticeMsgData.length,o=i,p=j,pd;noticeDom.innerHTML="";listDom=baidu("ul",noticeDom);if(!listDom.length){noticeDom.innerHTML=me._getIrregularField("ul");listDom=baidu("ul",noticeDom)}for(i;i<j;i++){pd=noticeMsgData[i];var cTemp=[];pd.html=me.changeHtml(pd.html);if(pd.status==1){pd.msgStatus=me._getIrregularField("msgNewTemp")}pd.msgType="notice";cTemp.push(me.tplEngine(me._getIrregularField("msgItemTemp"),pd));if(pd.concreteUrl){pd.concreteMsg=me.tplEngine(me._getIrregularField("concreteMsg"),{concreteUrl:pd.concreteUrl})}pd.content=cTemp.join("");temp.push(me.tplEngine(me._getIrregularField("noticeMsgItem"),pd))}listDom.append(baidu(temp.join("")));me._setMouseEvent("notice",o,p)}else{temp.push(me._getIrregularField("msgNone"));me.getElement("noticeMsgList").innerHTML=temp.join("")}},_setMouseEvent:function(type,i,j){var me=this,ul=baidu(me.getElement(type+"MsgList")).children("ul").get(0);for(i;i<j;i++){baidu(".pass-msgList-contentItem",ul.childNodes[i]).on({mouseenter:function(evt){baidu(this).children(".pass-msgList-remove").show()},mouseleave:function(evt){baidu(this).children(".pass-msgList-remove").hide()}});if(type=="notice"){baidu(ul.childNodes[i]).on({mouseenter:function(evt){baidu(this).get(0).style.background="#f7f7f7"},mouseleave:function(evt){baidu(this).get(0).style.background=""}})}}},drawPreview:function(temp){var me=this;var target=baidu(me.getElement());target.get(0).appendChild(baidu(temp).get(0));if(me.msgData.id&&me.config.loginType==1){me._changeMsgStatus()}me._setEvent();var returnValue=me.fireEvent("render");if(!returnValue){return}},offset:function(elem){var docElem,win,box={top:0,left:0};if(typeof elem.getBoundingClientRect!=="undefined"){box=elem.getBoundingClientRect()}else{while((elem=elem.offsetParent)){box.top+=elem.offsetTop;box.left+=elem.offsetLeft}}return box},_setSelectPos:function(evt,selectList){var me=this,$self=baidu(evt),aElem=baidu(".pass-topBar-level1",evt),offset;$self.addClass(me.constant.ITEMHOVERCLASS);offset=aElem.offset()||{top:0,left:0};if((offset.left+selectList.offsetWidth)>Math.max(document.body.clientWidth,document.documentElement.clientWidth)){selectList.style.left="-"+Math.max(selectList.offsetWidth-aElem.get(0).offsetWidth,0)+"px"}else{selectList.style.left="0px"}},_setSelectWidth:function(evt,selectList){var me=this,$self=baidu(evt),initWidth=$self.get(0).offsetWidth,a=baidu(".pass-topBar-level2",selectList),width=0,len=a.length;selectList.style.width="500px";selectList.style.display="block";for(var i=0;i<len;i++){var d=a[i];d.style.display="inline";width=Math.max(width,d.offsetWidth);d.style.display="block"}selectList.style.display="";selectList.style.width=(initWidth>width?(initWidth-2):width)+"px"},_upMsgDom:function(dom){var me=this,parentDom=baidu(dom.parentNode),tpl=parentDom.attr("tpl"),divDom=parentDom.get(0).parentNode,liDom=divDom.parentNode.parentNode,ulDom=liDom.parentNode,type=parentDom.attr("t"),status=parentDom.attr("s"),listDom=me.getElement(type+"MsgList"),divDom,liDom;me._removeMsg(tpl,parentDom.attr("mid"),1);if(type=="personal"){parentDom.remove();if(divDom.childNodes.length==0){baidu(liDom).remove()}}else{if(type=="notice"){baidu(liDom).remove()}}if(status==1){me.upMsgNewNum(type,"-1")}if(listDom.childNodes.length==0){listDom.innerHTML=me._getIrregularField("msgNone")}},_removeNewStatus:function(dom){var me=this,parentDom=baidu(dom.parentNode),type=parentDom.attr("t"),span=parentDom.children(".pass-msg-new");if(span.length>0){span.remove();parentDom.attr("s","0");me.upMsgNewNum(type,"-1")}},changeTab:function(type){var me=this;if(type!=me.msgData.currentMsgType){baidu(me.getElement(me.msgData.currentMsgType+"MsgTab")).removeClass("pass-msgType-current");baidu(me.getElement(type+"MsgTab")).addClass("pass-msgType-current");me.getElement(me.msgData.currentMsgType+"MsgList").style.display="none";me.getElement(type+"MsgList").style.display="block";me.msgData.currentMsgType=type;if(type=="notice"){baidu(".pass-msg-all",me.getElement("topBarWrapper")).attr("href","http://passport.baidu.com/v2/?messagehistorynotice");setTimeout(function(){me._setNoticeMsgStatus()},500)}else{baidu(".pass-msg-all",me.getElement("topBarWrapper")).attr("href","http://passport.baidu.com/v2/?messagehistory")}}},_setEvent:function(){var me=this,scrollTimer=null,parentDom=baidu(".pass-topBar-select",me.getElement("topBarWrapper")).parent(),msgFn=function(evt){var msg=baidu(evt.target).closest("#"+me.$getId("msgWrapper"));if(!msg.length){baidu(me.getElement("msgWrapper").parentNode).removeClass(me.constant.ITEMHOVERCLASS);me._changeMsgStatus(0);baidu(document).off("click",msgFn)}};parentDom.on("mouseenter",function(evt){var $self=baidu(this),selectList=baidu(".pass-topBar-select",this).get(0);if((me.config.defaultStyle!==false)&&(($self.attr("t")=="custom")||($self.attr("t")=="user"&&me.config.userShowType==1))){me._setSelectWidth(this,selectList)}me._setSelectPos(this,selectList)});baidu(me.getElement("noticeMsgList")).on("scroll",function(){clearTimeout(scrollTimer);scrollTimer=setTimeout(function(){me._setNoticeMsgStatus()},500)});baidu(".pass-topBar-item-msg .pass-topBar-level1").on("click",function(evt){var parentDom=this.parentNode,selectList=baidu(".pass-topBar-msgSelect",parentDom).get(0);if(baidu(parentDom).hasClass(me.constant.ITEMHOVERCLASS)){baidu(parentDom).removeClass(me.constant.ITEMHOVERCLASS);me._changeMsgStatus(0);baidu(document).off("click",msgFn)}else{me._getMsgData();setTimeout(function(){baidu(document).on("click",msgFn)},500);clearInterval(me.getMsgTimer)}evt.preventDefault()});parentDom.on("mouseleave",function(evt){var $self=baidu(this);baidu(this).removeClass(me.constant.ITEMHOVERCLASS)});baidu(".pass-msg-title li",me.getElement("msgWrapper")).on("mouseover",function(evt){me.changeTab(baidu(this).attr("t"))});baidu(me.getElement("msgWrapper")).on("click",function(evt){var target=evt.target;evt.stopPropagation();if(target.className.indexOf("pass-msgList-moreLink")>-1){me._setPersonalMsg();return}if(target.className.indexOf("pass-msgList-remove")>-1){me._upMsgDom(target);return}if(target.tagName.toLowerCase()=="a"&&target.parentNode.className.indexOf("pass-msgList-contentItem")>-1){me._removeNewStatus(target)}if(target.className.indexOf("pass-msg-close")>-1){baidu(me.getElement("msgWrapper").parentNode).removeClass(me.constant.ITEMHOVERCLASS);me._changeMsgStatus(0)}if(target.className.indexOf("pass-msg-read")>-1){me._read()}});baidu(".pass-topBar-jsMethod",me.getElement("topBarWrapper")).on("click",function(evt){var $self=baidu(this),data=me.data[(me.config.loginType==1)?"hlogin":"nlogin"],id,js,sort;var returnValue=me.fireEvent("jsClick",evt);if(!returnValue){return}if($self.attr("data-level")=="1"){id=$self.parent().attr("data-id");js=(data["id"+id]&&data["id"+id].js)||"";eval(js)}else{if($self.attr("data-level")=="2"){id=$self.parent().parent().attr("data-id");sort=$self.attr("data-sort");data=data["id"+id]&&data["id"+id].subConfig;if(data&&data.length>0){js=(data[sort]&&data[sort].js)||"";eval(js)}}}evt.preventDefault();evt.stopPropagation()})},render:function(id){var me=this;if(!me.getElement()){me.$mappingDom("",id||document.body)}if(me.config.loginType==1){me.getUserData()}if(me.config.defaultStyle!==false){me._loadCss(me.constant.DEFAULTSTYLE)}me.getData()}});return magic});